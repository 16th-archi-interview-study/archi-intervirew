# 뉴스 피드 시스템의 데이터 구성 책임: 클라이언트, 서버
이 문서는 기존 11장 내용에서 확장하여 구성한 것으로, 뉴스피드 시스템에서 사용자 정보, 콘텐츠, 미디어 등의 데이터를 조합할 때,
그 책임이 클라이언트에 있을지 서버(BFF 포함)에 있을지에 대한 설계 전략을 정리하고 비교한다.


## 1. 클라이언트 책임: 쪼갠 API + 병렬 호출
클라이언트가 사용자 정보, 포스트 본문, 미디어 등을 별도로 API로 요청하고, 먼저 도착한 정보부터 화면에 점진적으로 렌더링할 수 있다.


이 방식은 사용자 경험(UX)을 빠르게 만들 수 있지만,
    - API 분리
    - 스켈레톤 UI 관리 (예를 들어, 기존에 하나의 컴포넌트로 완성된 것 내부를 쪼개서 스켈레톤 로딩 UI를 그려야 할수도 있다.)
    - 에러/비동기 타이밍 처리 등 복잡한 앱 구조가 필요해진다.


특히, 네이티브 앱(Android, iOS)은 이런 처리를 어느 정도 감당할 수 있지만, 크로스플랫폼(React Native, Flutter 등)에서는 클라이언트 책임을 줄이는 쪽이 트렌드로 보인다. (복잡한 설계를 감당하는 것도 비용이기 때문)


## 2. 서버 조합형: 클라이언트는 단순히 렌더링만
서버가 각 마이크로서비스(`UserService`, `PostService` 등)에서 데이터를 수집하고 조합하여 **"완성된 뉴스피드 JSON"**으로 내려준다.
클라이언트는 단일 API `GET /v1/me/feed`만 호출하고, 응답에 따라 렌더링만 담당하면 되므로 구현이 단순하다.


트레이드오프는 서버의 조합 비용과 응답 시간이 약간 길어질 수 있다는 점인데, 네트워크 환경이 좋지 않은 모바일 기기의 경우 round-trip을 한 번만 하는게 더 유리할 수도 있어서(API 호출 횟수가 적은게 더 좋다는 의미) 여러 상황에서 장단점이 있다.


## 3. BFF 패턴: 플랫폼별 요구에 맞춰 유연하게 대응
요즘 많은 서비스가 MSA 환경으로 구성되어 있고, 하나의 API가 여러 플랫폼에서 재사용되어야 하는 경우가 있다.


예를 들어, 하나의 뉴스 피드 서비스가 Android, iOS, Web 등 여러 플랫폼에서 재사용된다면, 플랫폼에 따라 필요한 데이터 양식과 우선순위가 달라질 수 있다.


이를 해결하기 위해 BFF(Backend For Frontend) 패턴을 도입한다.
- 각각의 플랫폼에 맞는 데이터 조합을,
- 서버(BFF)에서 담당하고,
- 내부 마이크로서비스들과는 병렬로 통신하여 유연하게 응답 조립이 가능하다.


즉, 하나의 API를 각각 플랫폼에서 동일하게 호출하면, BFF 계층에서 각 플랫폼에 맞춘 응답 구조를 내려주는 형태이다.
이런 경우, 응답 JSON 마저 클라이언트에 최적화한 자연어로 내려주어 그냥 렌더링만 하도록 구성하기도 한다. (클라의 책임 최소화)


## 결론
- 클라이언트 & 서버 측의 협의를 통해 어느 정도의 책임을 가질지 협의를 통해 책임 분리를 하고 설계할 수 있다.
   - ex. 우리 서비스에서 추구하는 UX/UI의 병렬 처리 수준은 어느 정도인지?
- 다양화된 플랫폼 대응성, MSA 구조에서는 BFF 패턴을 적용할 수 있다.
    - 즉, BFF 계층을 하나 더 두고 응답 완성의 책임을 주는 것이다.
    - 당연히, 플랫폼별 비대칭성이 있는 경우 자유롭게 스케일링 할 수 있다.
    - 뉴스 피드 시스템 특징 상, 다양한 플랫폼에 대응해야할 확률이 높고 추구하는 UX/UI에 따라 더 다양한 전략이 나올 수 있다.
    - AWS, Netflix 등 다양한 플랫폼을 제공해야하는 글로벌 기업에서는 최근 꽤 적극적으로 채택 중이고, 국내에서는 카카오의 도입사례를 볼 수 있다.


---
ref.
- [AWS - BFF Pattern](https://aws.amazon.com/ko/blogs/mobile/backends-for-frontends-pattern/)
- [Netflix - Android 환경에서 BFF 도입기](https://netflixtechblog.com/seamlessly-swapping-the-api-backend-of-the-netflix-android-app-3d4317155187)
- [Kakao Ent. - BFF 설명 및 도입기](https://tech.kakaoent.com/front-end/2022/220310-kakaopage-bff/)
- [KakaoPay - BFF 서버 Webflux Coroutine으로 구축하기](https://tech.kakaopay.com/post/bff_webflux_coroutine/)