# 1장: 사용자수에 따른 규모 확장성
- 1장은 사용자 수가 증가할 때, 시스템 규모를 어떻게 확장해야 하는지 다양한 기법들에 대해 순차적으로 설명하고 있다. 
- 단일 서버에서 확장을 위해 분리해야하는 컴포넌트, 개념에 대해서 설명하고 마지막에는 1장에서 강조한 시스템 규모 확장 기법들을 정리하겠다.


## 단일 서버에서 점진적으로 확장하기
- 모든 컴포넌트가(웹 앱, 데이터베이스, 캐시 등) 전부 서버 한 대에서 실행된다고 가정
- 서버에서 사용자 요청 처리 흐름
    1. 사용자는 도메인 이름을 이용하여 웹사이트에 접속 (DNS에 질의하여 IP 주소로 변환 필요)
    2. DNS 조회 결과로 반환된 IP 주소 (웹 서버의 주소) 찾기
    3. 해당 IP 주소로 HTTP 요청 전달
    4. 요청을 받은 웹 서버는 HTML 페이지나 JSON 형태의 응답 반환


## 데이터베이스 분리하기
- 사용자가 늘면 단일 서버로 충분하지 않다.
- 웹 서버와 데이터베이스 서버를 분리하면 각각을 독립적으로 확장해 나갈 수 있다.
- 어떤 데이터베이스를 사용할 것인지 고르는 것도 중요하다.
    - 전통적인 관계형 데이터베이스 (RDBMS)
    - 비관계형 데이터베이스 (NoSQL)
        - 대표적으로 4가지 분류로 나눌 수 있고, 일반적으로 Join 연산을 지원하지 않거나 성능이 나쁘다.
            1. 키-값 저장소 (KV store)
            2. 그래프 저장소 (Graph store)
            3. 칼럼 저장소 (Column store)
            4. 문서 저장소 (Document sotre)
- 보통 RDBMS 를 많이 사용하나, 아래와 같은 경우에 NoSQL 사용을 고려하면 좋다.
    - 매우 낮은 응답 latency 요구될 때
    - 다루는 데이터가 비정형이고, 관계형 데이터가 아닐 때
    - 데이터를 직렬화하거나 역직렬화 할 수 있기만 하면 되는 경우
    - 아주 많은 양의 데이터를 저장할 필요가 있는 경우 (쓰기 용량 최적화가 필요하거나 속도 등 쓰기 성능 측면에서 예민한 경우)


## 수직적 규모 확장(Scale-up) vs 수평적 규모 확장(Scale-out)
- Scale-up
    - 서버에 고사양 자원 추가 (더 성능 좋은 CPU, RAM 용량 추가 등)
    - 서버에 유입되는 트래픽 양이 적을 때 시도하기 좋음 → 단순한 솔루션이라서
    - 단점
        - 아무리 사양을 업그레이드해도 CPU나 RAM 성능을 늘리는데 한계가 있다.
        - 장애에 대한 자동 복구(failover) 방안이나 다중화(redundancy) 방안이 없다.
        - 서버 장애 발생 시 서비스가 완전히 중단되는 치명적인 문제가 있다.
- Scale-out
    - 서버 인스턴스를 늘리면서 처리량을 늘려 성능 개선
    - Scale-up의 단점과 한계로 인해, 대규모 애플리케이션을 지원하는데에 Scale-out이 더 적절하다.


## 웹 계층에서 확장 - 로드밸런서
- 단일 서버 설계에서 사용자는 웹 서버에 바로 연결되는데, 바로 연결되는 것보다 로드밸런서를 거치는 것이 더 좋다.
- 로드밸런서는 load balancing set에 속한 웹 서버들에게 트래픽 부하를 고르게 분산한다.
- 사용자가 로드밸런서의 공개 IP 주소로 접속하고, 적절한 웹 서버로 연결시킨다.
- 서버 간 통신은 사설 IP 주소를 사용하여 외부 접속을 못하게 하면 보안을 강화할 수 있다.


## 데이터 계층에서 확장 - 데이터베이스 다중화
- 


## 응답 속도 개선 - 캐싱
- 캐시 계층
- CDN (콘텐츠 전송 네트워크)


---


## 시스템 규모 확장을 위한 전체 기법 정리
1. 웹 계층은 무상태 계층으로 한다. → 세션 관리 힘듦 (stickty session)
2. 모든 계층에 다중화를 도입할 수 있다.
3. 가능한 많은 데이터를 캐싱한다.
4. 여러 데이터 센터를 지원한다.
5. 정적 콘텐츠는 CDN을 통해 서비스한다.
6. 데이터 계층은 샤딩을 통해 그 규모를 확장한다.
7. 각 계층은 독립적인 서비스로 분할할 수 있다. → But 분할 시 생기는 문제점
8. 시스템을 지속적으로 모니터링하고, 자동화 도구들을 활용하자. → 로그, 메트릭 분석

